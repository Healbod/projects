# Примеры проектов

* [Прогнозирование количества поездок такси в каждом районе Нью-Йорка в ближайшие часы](#Taxi_TimeSeries)
* [Прогнозирование победителя в игре Dota 2](#Dota_predict_win)

---

## <a name="Taxi_TimeSeries"></a> Прогнозирование количества поездок такси в каждом районе Нью-Йорка в ближайшие часы 

Нью-Йоркская комиссия по такси и лимузинам (TLC) предоставляет подробные анонимизированные данные о поездках клиентов с 2009 года. Машины, выкрашенные жёлтым, имеют право брать пассажиров на улицах в любом из пяти бюро города.

Сырые данные о поездках в жёлтом такси можно найти на сайте [TLC](http://www.nyc.gov/html/tlc/html/about/trip_record_data.shtml).
Эти данные разбиты на файлы по месяцам. В каждом из файлов содержится следующая информация о поездках:
* время начала поездки
* время окончания поездки
* долгота и широта точки начала поездки
* долгота и широта точки окончания поездки
* количество пассажиров
* расстояние по счётчику
* тип тарифа (одна из шести категорий)
* способ оплаты (одна из шести категорий)
* стоимость поездки по счётчику
* налог на счётчик
* доплата за поездки в пиковые часы и ночью
* доплата за проезд по платным дорогам
* доплата за проезд, взимаемая с каждой поездки с января 2015
* размер чаевых
* общая стоимость поездки
* провайдер данных (одна из двух категорий)
* бинарный флаг, показывающий, были ли данные о поездке получены немедленно после её окончания, или какое-то время хранились в памяти автомобиля.

Подробнее можно узнать [здесь](http://www.nyc.gov/html/tlc/downloads/pdf/data_dictionary_trip_records_yellow.pdf)
 
**ЗАДАЧА**
> Научиться предсказывать количество поездок в ближайшие часы в каждом районе Нью-Йорка.

Для решения этой задачи, сырые данные очищаются от ошибок и аномалий. Далее Нью-Йорк вписывается в прямоугольник от -74.25559 до -73.70001 градусов долготы и от 40.49612 до 40.91553 широты. Получившийся прямоугольник разбивается на 2500 одинаковых прямоугольных районов — по 50 интервалов вдоль каждой оси.
 
![regions](taxi_NY/data/df_regions/regions.jpg "Regions")

Отфильтруем районы, оставив те из которых совершается в среднем более 5 поездок в час.

![regions_filter](taxi_NY/data/df_regions/regions_fillter.jpg "Regions_Filter")

Данные из получившихся районов агрегируются по времени. Агрегированные данные представляют собой почасовые временные ряды с количествами поездок из каждого района.
Задача прогнозирования таких рядов решается с помощью авторегрессионных моделей, прогнозируя каждый ряд независимо. Так как ряды имеют сложную сезонность — суточную, недельную и годовую, для их моделирования используется модель ARIMA с дополнительной регрессией на внешние признаки.

Для увеличения точности предсказания моделей введены дополнительные признаки:
* средняя длительность поездок
* среднее количество пассажиров
* среднее расстояние по счётчику
* средняя стоимость поездок
* суммарное количество поездок за предшествующие полдня, сутки, неделю
* информация о праздничных днях
* и др.

Подробнее с этапами выполнения проекта можно ознакомиться по ссылкам:
* [знакомство с данными и агрегация](taxi_NY/week1_Taxi.ipynb)
* [работа с геоданными](taxi_NY/week2_Taxi.ipynb)
* [прогнозирование ряда со сложной сезонностью](taxi_NY/week3_Taxi.ipynb)
* [прогнозирование большого количества рядов](taxi_NY/week4_Taxi.ipynb)
* [прогнозирование с помощью регрессии](taxi_NY/week5_Taxi.ipynb)
* [дополнительные признаки](taxi_NY/week6_Taxi.ipynb)
* [оформление проекта](taxi_NY/week7_Taxi.ipynb)

**РЕЗУЛЬТАТЫ**

Результаты проекта представлены в виде:
* карта с визуализацией реального и прогнозируемого спроса на такси в выбираемый пользователем момент времени

![predict_map](taxi_NY/data/df_regions/predict_map.JPG "Predict_map")

* временной ряд фактического и прогнозируемого спроса на такси в выбираемой пользователем области

![predict_figure](taxi_NY/data/df_regions/predict_figure_region.jpg "Predict_figure")

**ИТОГИ**
> * данный подход может быть применен к задачам, где необходимо спрогнозировать продажи большого количества товаров в большом количестве магазинов, объём снятия денег в сети банкоматов, посещаемость разных страниц сайта и т.д. 
> 
> В ходе выполнения проекта:
> * научились работать с геоданными и использовать различные библиотеки, модели и средства для анализа данных
> * спрогнозировали временные ряды сложной структуры
> * построили и научились настраивать регрессионные модели, делающие совместные предсказания для большого количества взаимосвязанных рядов

 ---
 
 ---
 
## <a name="Dota_predict_win"></a> Прогнозирование победителя в игре Dota 2

Dota 2 — многопользовательская компьютерная игра жанра MOBA. Игроки соревнуются между собой в режиме матча. В каждом матче участвует две команды, 5 человек в каждой. Одна команда играет за светлую сторону (The Radiant), другая — за тёмную (The Dire). Цель каждой команды — уничтожить главное здание базы противника (трон).

Существуют разные режимы игры, мы будем рассматривать режим Captain's Mode, в формате которого происходит большая часть киберспортивных мероприятий по Dota 2.
 
![](http://imgur.com/Du79Kzf.jpg)
 
**ЗАДАЧА**
> По первым 5 минутам игры предсказать, какая из команд победит: Radiant или Dire?

Набор данных был сделан на основе выгрузки [YASP 3.5 Million Data Dump](http://academictorrents.com/details/5c5deeb6cfe1c944044367d2e7465fd8bd2f4acf) реплеев матчей Dota 2 с сайта [yasp.co](http://yasp.co/).

С помощью скрипта производится извлечение признаков из известной информации о матче за первые 5 игровых минут, составляет из них таблицу. Таблица поможет быстрее сформировать матрицу объект-признак, вектор ответов и начать применять методы машинного обучения для решения поставленной задачи.

В итоговую таблицу вошли следующие признаки
- `match_id`: идентификатор матча в наборе данных
- `start_time`: время начала матча (unixtime)
- `lobby_type`: тип комнаты, в которой собираются игроки (расшифровка в `dictionaries/lobbies.csv`)
- Наборы признаков для каждого игрока (игроки команды Radiant — префикс `rN`, Dire — `dN`):
    - `r1_hero`: герой игрока (расшифровка в dictionaries/heroes.csv)
    - `r1_level`: максимальный достигнутый уровень героя (за первые 5 игровых минут)
    - `r1_xp`: максимальный полученный опыт
    - `r1_gold`: достигнутая ценность героя
    - `r1_lh`: число убитых юнитов
    - `r1_kills`: число убитых игроков
    - `r1_deaths`: число смертей героя
    - `r1_items`: число купленных предметов
- Признаки события "первая кровь" (first blood). Если событие "первая кровь" не успело произойти за первые 5 минут, то признаки принимают пропущенное значение
    - `first_blood_time`: игровое время первой крови
    - `first_blood_team`: команда, совершившая первую кровь (0 — Radiant, 1 — Dire)
    - `first_blood_player1`: игрок, причастный к событию
    - `first_blood_player2`: второй игрок, причастный к событию
- Признаки для каждой команды (префиксы `radiant_` и `dire_`)
    - `radiant_bottle_time`: время первого приобретения командой предмета "bottle"
    - `radiant_courier_time`: время приобретения предмета "courier" 
    - `radiant_flying_courier_time`: время приобретения предмета "flying_courier" 
    - `radiant_tpscroll_count`: число предметов "tpscroll" за первые 5 минут
    - `radiant_boots_count`: число предметов "boots"
    - `radiant_ward_observer_count`: число предметов "ward_observer"
    - `radiant_ward_sentry_count`: число предметов "ward_sentry"
    - `radiant_first_ward_time`: время установки командой первого "наблюдателя", т.е. предмета, который позволяет видеть часть игрового поля
- Итог матча (данные поля отсутствуют в тестовой выборке, поскольку содержат информацию, выходящую за пределы первых 5 минут матча)
    - `duration`: длительность
    - `radiant_win`: 1, если победила команда Radiant, 0 — иначе
    - Состояние башен и барраков к концу матча (см. описание полей набора данных)
        - `tower_status_radiant`
        - `tower_status_dire`
        - `barracks_status_radiant`
        - `barracks_status_dire`

**РЕЗУЛЬТАТЫ**

По результатам применения различных моделей машинного обучения получили следующее:
* применении градиентного бустинга с 30 деревьями дает качество прогнозов (отношение правильных предсказаний) 0.6895
* применение логической регрессии даёт качество прогнозов 0.716315
* применение логической регресси при добавлении "мешка слов" по героям даёт качество прогноза 0.7507 

**ИТОГИ**
> * данный подход может быть применен к задачам, где необходимо предсказания вероятности покупки услуги клиентом банка, предсказание вероятности оттока клиента к другому поставщику услуг и т.д. 
> 
> В ходе выполнения проекта:
> * научились извлекать признаки из сырых данных и использовать различные библиотеки и средства для анализа данных
> * применили различные модели машинного обучения и проанализировали как добавление признаков влияет на качество прогноза

---
 